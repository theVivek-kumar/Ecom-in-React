{"ast":null,"code":"import { v4 as uuid } from \"uuid\";\nimport { Response } from \"miragejs\";\nimport { formatDate } from \"../utils/authUtils\";\n\nconst sign = require(\"jwt-encode\");\n/**\n * All the routes related to Auth are present here.\n * These are Publicly accessible routes.\n * */\n\n/**\n * This handler handles user signups.\n * send POST Request at /api/auth/signup\n * body contains {firstName, lastName, email, password}\n * */\n\n\nexport const signupHandler = function (schema, request) {\n  const {\n    email,\n    password,\n    ...rest\n  } = JSON.parse(request.requestBody);\n\n  try {\n    // check if email already exists\n    const foundUser = schema.users.findBy({\n      email\n    });\n\n    if (foundUser) {\n      return new Response(422, {}, {\n        errors: [\"Unprocessable Entity. Email Already Exists.\"]\n      });\n    }\n\n    const _id = uuid();\n\n    const newUser = {\n      _id,\n      email,\n      password,\n      createdAt: formatDate(),\n      updatedAt: formatDate(),\n      ...rest,\n      cart: [],\n      wishlist: []\n    };\n    const createdUser = schema.users.create(newUser);\n    const encodedToken = sign({\n      _id,\n      email\n    }, process.env.REACT_APP_JWT_SECRET);\n    return new Response(201, {}, {\n      createdUser,\n      encodedToken\n    });\n  } catch (error) {\n    return new Response(500, {}, {\n      error\n    });\n  }\n};\n/**\n * This handler handles user login.\n * send POST Request at /api/auth/login\n * body contains {email, password}\n * */\n\nexport const loginHandler = function (schema, request) {\n  const {\n    email,\n    password\n  } = JSON.parse(request.requestBody);\n\n  try {\n    const foundUser = schema.users.findBy({\n      email\n    });\n\n    if (!foundUser) {\n      return new Response(404, {}, {\n        errors: [\"The email you entered is not Registered. Not Found error\"]\n      });\n    }\n\n    if (password === foundUser.password) {\n      const encodedToken = sign({\n        _id: foundUser._id,\n        email\n      }, process.env.REACT_APP_JWT_SECRET);\n      foundUser.password = undefined;\n      return new Response(200, {}, {\n        foundUser,\n        encodedToken\n      });\n    }\n\n    new Response(401, {}, {\n      errors: [\"The credentials you entered are invalid. Unauthorized access error.\"]\n    });\n  } catch (error) {\n    return new Response(500, {}, {\n      error\n    });\n  }\n};","map":{"version":3,"sources":["F:/website 2020/Ecom-in-React/ecom-app/src/backend/controllers/AuthController.js"],"names":["v4","uuid","Response","formatDate","sign","require","signupHandler","schema","request","email","password","rest","JSON","parse","requestBody","foundUser","users","findBy","errors","_id","newUser","createdAt","updatedAt","cart","wishlist","createdUser","create","encodedToken","process","env","REACT_APP_JWT_SECRET","error","loginHandler","undefined"],"mappings":"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","sourcesContent":["import { v4 as uuid } from \"uuid\";\nimport { Response } from \"miragejs\";\nimport { formatDate } from \"../utils/authUtils\";\nconst sign = require(\"jwt-encode\");\n/**\n * All the routes related to Auth are present here.\n * These are Publicly accessible routes.\n * */\n\n/**\n * This handler handles user signups.\n * send POST Request at /api/auth/signup\n * body contains {firstName, lastName, email, password}\n * */\n\nexport const signupHandler = function (schema, request) {\n  const { email, password, ...rest } = JSON.parse(request.requestBody);\n  try {\n    // check if email already exists\n    const foundUser = schema.users.findBy({ email });\n    if (foundUser) {\n      return new Response(\n        422,\n        {},\n        {\n          errors: [\"Unprocessable Entity. Email Already Exists.\"],\n        }\n      );\n    }\n    const _id = uuid();\n    const newUser = {\n      _id,\n      email,\n      password,\n      createdAt: formatDate(),\n      updatedAt: formatDate(),\n      ...rest,\n      cart: [],\n      wishlist: [],\n    };\n    const createdUser = schema.users.create(newUser);\n    const encodedToken = sign({ _id, email }, process.env.REACT_APP_JWT_SECRET);\n    return new Response(201, {}, { createdUser, encodedToken });\n  } catch (error) {\n    return new Response(\n      500,\n      {},\n      {\n        error,\n      }\n    );\n  }\n};\n\n/**\n * This handler handles user login.\n * send POST Request at /api/auth/login\n * body contains {email, password}\n * */\n\nexport const loginHandler = function (schema, request) {\n  const { email, password } = JSON.parse(request.requestBody);\n  try {\n    const foundUser = schema.users.findBy({ email });\n    if (!foundUser) {\n      return new Response(\n        404,\n        {},\n        { errors: [\"The email you entered is not Registered. Not Found error\"] }\n      );\n    }\n    if (password === foundUser.password) {\n      const encodedToken = sign(\n        { _id: foundUser._id, email },\n        process.env.REACT_APP_JWT_SECRET\n      );\n      foundUser.password = undefined;\n      return new Response(200, {}, { foundUser, encodedToken });\n    }\n    new Response(\n      401,\n      {},\n      {\n        errors: [\n          \"The credentials you entered are invalid. Unauthorized access error.\",\n        ],\n      }\n    );\n  } catch (error) {\n    return new Response(\n      500,\n      {},\n      {\n        error,\n      }\n    );\n  }\n};\n"]},"metadata":{},"sourceType":"module"}